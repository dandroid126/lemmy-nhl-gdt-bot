import datetime
import json
import unittest

import requests
from dateutil.tz import tzutc

import tests.test_constants as test_constants
from src.datatypes.game import Game
from src.datatypes.game_info import GameInfo
from src.datatypes.goal import Goal
from src.datatypes.penalty import Penalty
from src.datatypes.period import Period
from src.datatypes.shootout import Shootout
from src.datatypes.team_stats import TeamStats
from src.datatypes.teams import Team
from src.utils import nhl_api_client

LANDING_TEST_FILE_PATH = f"{test_constants.TEST_RES_PATH}/2022020158_landing.json"
SCHEDULED_LANDING_TEST_FILE_PATH = f"{test_constants.TEST_RES_PATH}/2023020576_landing.json"


class TestNhlApiClient(unittest.TestCase):
    def setUp(self):
        self.maxDiff = None
        with open(LANDING_TEST_FILE_PATH, "r") as file:
            json_string = file.read()
            self.landing = json.loads(json_string)
        with open(SCHEDULED_LANDING_TEST_FILE_PATH, "r") as file:
            json_string = file.read()
            self.scheduled_landing = json.loads(json_string)

    def test_parse_goals(self):
        expected = [Goal(period='1st', time='05:16', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), strength='Even Strength', description='Adam Henrique (1) wrist shot, assists: Kevin Shattenkirk (3)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335809960112'), Goal(period='1st', time='06:18', team=Team(id=28, abbreviation='SJS', city='San Jose', name='Sharks', logo_url='https://lemmy.ca/pictrs/image/a278e5aa-6f6f-4cdb-a0dc-03630b03a3a9.png'), strength='Even Strength', description='Erik Karlsson (7) wrist shot, assists: Evgeny Svechnikov (3), Tomas Hertl (6)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335811710112'), Goal(period='1st', time='06:41', team=Team(id=28, abbreviation='SJS', city='San Jose', name='Sharks', logo_url='https://lemmy.ca/pictrs/image/a278e5aa-6f6f-4cdb-a0dc-03630b03a3a9.png'), strength='Even Strength', description='Erik Karlsson (8) slap shot, assists: Jaycob Megna (4), Nico Sturm (1)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810655112'), Goal(period='1st', time='10:52', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), strength='Even Strength', description='Frank Vatrano (4) wrist shot, assists: Isac Lundestrom (4), Jakob Silfverberg (1)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810159112'), Goal(period='1st', time='19:45', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), strength='Even Strength', description='Adam Henrique (2) backhand shot, assists: Trevor Zegras (2), Kevin Shattenkirk (4)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335808677112'), Goal(period='2nd', time='03:28', team=Team(id=28, abbreviation='SJS', city='San Jose', name='Sharks', logo_url='https://lemmy.ca/pictrs/image/a278e5aa-6f6f-4cdb-a0dc-03630b03a3a9.png'), strength='Power Play', description='Timo Meier (2) backhand shot, assists: Alexander Barabanov (4), Erik Karlsson (6)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810650112'), Goal(period='2nd', time='15:10', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), strength='Even Strength', description='Ryan Strome (2) deflected shot, assists: John Klingberg (3), Troy Terry (7)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810252112'), Goal(period='2nd', time='15:31', team=Team(id=28, abbreviation='SJS', city='San Jose', name='Sharks', logo_url='https://lemmy.ca/pictrs/image/a278e5aa-6f6f-4cdb-a0dc-03630b03a3a9.png'), strength='Even Strength', description='Timo Meier (3)  shot, assists: None', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810713112'), Goal(period='3rd', time='11:31', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), strength='Even Strength', description='Max Comtois (2) wrist shot, assists: Troy Terry (8), Nathan Beaulieu (1)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335811310112'), Goal(period='3rd', time='17:48', team=Team(id=28, abbreviation='SJS', city='San Jose', name='Sharks', logo_url='https://lemmy.ca/pictrs/image/a278e5aa-6f6f-4cdb-a0dc-03630b03a3a9.png'), strength='Even Strength', description='Erik Karlsson (9) wrist shot, assists: Alexander Barabanov (5), Tomas Hertl (7)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810352112'), Goal(period='SO', time='00:00', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), strength='Even Strength', description='Troy Terry (4) backhand shot, assists: None', video_url='')]
        goals = nhl_api_client.parse_goals(self.landing)
        print(goals)
        self.assertEqual(goals, expected)

    def test_parse_game(self):
        expected = Game(id=2022020158, away_team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), home_team=Team(id=28, abbreviation='SJS', city='San Jose', name='Sharks', logo_url='https://lemmy.ca/pictrs/image/a278e5aa-6f6f-4cdb-a0dc-03630b03a3a9.png'), start_time=datetime.datetime(2022, 11, 2, 2, 30, tzinfo=tzutc()), end_time=None, game_info=GameInfo(current_period='SO', game_clock='FINAL'), away_team_stats=TeamStats(goals=6, shots=44, blocked=9, hits=19, fo_wins=0.553846, giveaways=10, takeaways=10, pp_fraction='0/4', periods=[Period(goals=3, shots=17, period_number=1, ordinal_number='1st'), Period(goals=1, shots=15, period_number=2, ordinal_number='2nd'), Period(goals=1, shots=9, period_number=3, ordinal_number='3rd'), Period(goals=0, shots=3, period_number=4, ordinal_number='OT')], shootout=Shootout(scores=2, attempts=2, has_been_played=True)), home_team_stats=TeamStats(goals=5, shots=44, blocked=17, hits=16, fo_wins=0.446154, giveaways=10, takeaways=10, pp_fraction='1/3', periods=[Period(goals=2, shots=10, period_number=1, ordinal_number='1st'), Period(goals=2, shots=18, period_number=2, ordinal_number='2nd'), Period(goals=1, shots=14, period_number=3, ordinal_number='3rd'), Period(goals=0, shots=2, period_number=4, ordinal_number='OT')], shootout=Shootout(scores=1, attempts=3, has_been_played=True)), goals=[Goal(period='1st', time='05:16', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), strength='Even Strength', description='Adam Henrique (1) wrist shot, assists: Kevin Shattenkirk (3)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335809960112'), Goal(period='1st', time='06:18', team=Team(id=28, abbreviation='SJS', city='San Jose', name='Sharks', logo_url='https://lemmy.ca/pictrs/image/a278e5aa-6f6f-4cdb-a0dc-03630b03a3a9.png'), strength='Even Strength', description='Erik Karlsson (7) wrist shot, assists: Evgeny Svechnikov (3), Tomas Hertl (6)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335811710112'), Goal(period='1st', time='06:41', team=Team(id=28, abbreviation='SJS', city='San Jose', name='Sharks', logo_url='https://lemmy.ca/pictrs/image/a278e5aa-6f6f-4cdb-a0dc-03630b03a3a9.png'), strength='Even Strength', description='Erik Karlsson (8) slap shot, assists: Jaycob Megna (4), Nico Sturm (1)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810655112'), Goal(period='1st', time='10:52', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), strength='Even Strength', description='Frank Vatrano (4) wrist shot, assists: Isac Lundestrom (4), Jakob Silfverberg (1)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810159112'), Goal(period='1st', time='19:45', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), strength='Even Strength', description='Adam Henrique (2) backhand shot, assists: Trevor Zegras (2), Kevin Shattenkirk (4)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335808677112'), Goal(period='2nd', time='03:28', team=Team(id=28, abbreviation='SJS', city='San Jose', name='Sharks', logo_url='https://lemmy.ca/pictrs/image/a278e5aa-6f6f-4cdb-a0dc-03630b03a3a9.png'), strength='Power Play', description='Timo Meier (2) backhand shot, assists: Alexander Barabanov (4), Erik Karlsson (6)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810650112'), Goal(period='2nd', time='15:10', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), strength='Even Strength', description='Ryan Strome (2) deflected shot, assists: John Klingberg (3), Troy Terry (7)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810252112'), Goal(period='2nd', time='15:31', team=Team(id=28, abbreviation='SJS', city='San Jose', name='Sharks', logo_url='https://lemmy.ca/pictrs/image/a278e5aa-6f6f-4cdb-a0dc-03630b03a3a9.png'), strength='Even Strength', description='Timo Meier (3)  shot, assists: None', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810713112'), Goal(period='3rd', time='11:31', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), strength='Even Strength', description='Max Comtois (2) wrist shot, assists: Troy Terry (8), Nathan Beaulieu (1)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335811310112'), Goal(period='3rd', time='17:48', team=Team(id=28, abbreviation='SJS', city='San Jose', name='Sharks', logo_url='https://lemmy.ca/pictrs/image/a278e5aa-6f6f-4cdb-a0dc-03630b03a3a9.png'), strength='Even Strength', description='Erik Karlsson (9) wrist shot, assists: Alexander Barabanov (5), Tomas Hertl (7)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810352112'), Goal(period='SO', time='00:00', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), strength='Even Strength', description='Troy Terry (4) backhand shot, assists: None', video_url='')], penalties=[Penalty(period='1st', time='08:55', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), type='Minor', min=2, description='Max Comtois holding against Evgeny Svechnikov'), Penalty(period='1st', time='08:55', team=Team(id=28, abbreviation='SJS', city='San Jose', name='Sharks', logo_url='https://lemmy.ca/pictrs/image/a278e5aa-6f6f-4cdb-a0dc-03630b03a3a9.png'), type='Minor', min=2, description='Evgeny Svechnikov roughing against Max Comtois'), Penalty(period='2nd', time='03:05', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), type='Minor', min=2, description='Max Jones holding-the-stick against Steven Lorentz'), Penalty(period='2nd', time='03:33', team=Team(id=28, abbreviation='SJS', city='San Jose', name='Sharks', logo_url='https://lemmy.ca/pictrs/image/a278e5aa-6f6f-4cdb-a0dc-03630b03a3a9.png'), type='Major', min=5, description='Luke Kunin fighting against Nathan Beaulieu'), Penalty(period='2nd', time='03:33', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), type='Major', min=5, description='Nathan Beaulieu fighting against Luke Kunin'), Penalty(period='2nd', time='04:48', team=Team(id=28, abbreviation='SJS', city='San Jose', name='Sharks', logo_url='https://lemmy.ca/pictrs/image/a278e5aa-6f6f-4cdb-a0dc-03630b03a3a9.png'), type='Minor', min=2, description='Steven Lorentz tripping against Troy Terry'), Penalty(period='2nd', time='08:56', team=Team(id=28, abbreviation='SJS', city='San Jose', name='Sharks', logo_url='https://lemmy.ca/pictrs/image/a278e5aa-6f6f-4cdb-a0dc-03630b03a3a9.png'), type='Minor', min=2, description='Kevin Labanc hooking against Mason McTavish'), Penalty(period='2nd', time='12:31', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), type='Minor', min=2, description='Trevor Zegras slashing against Matt Benning'), Penalty(period='2nd', time='16:06', team=Team(id=28, abbreviation='SJS', city='San Jose', name='Sharks', logo_url='https://lemmy.ca/pictrs/image/a278e5aa-6f6f-4cdb-a0dc-03630b03a3a9.png'), type='Minor', min=2, description='Logan Couture interference against Isac Lundestrom'), Penalty(period='2nd', time='19:05', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), type='Minor', min=2, description='Derek Grant roughing against Radim Simek'), Penalty(period='3rd', time='17:48', team=Team(id=24, abbreviation='ANA', city='Anaheim', name='Ducks', logo_url='https://lemmy.ca/pictrs/image/9efd8b21-3414-4e4f-8be3-559809ec133a.png'), type='Misconduct', min=10, description='Kevin Shattenkirk misconduct'), Penalty(period='OT', time='00:22', team=Team(id=28, abbreviation='SJS', city='San Jose', name='Sharks', logo_url='https://lemmy.ca/pictrs/image/a278e5aa-6f6f-4cdb-a0dc-03630b03a3a9.png'), type='Minor', min=2, description='Erik Karlsson holding against Troy Terry')])
        game = nhl_api_client.parse_game(self.landing)
        print(game)
        self.assertEqual(game, expected)

    def test_parse_scheduled_game(self):
        expected = Game(id=2023020576, away_team=Team(id=15, abbreviation='WSH', city='Washington', name='Capitals', logo_url='https://lemmy.ca/pictrs/image/045d8587-6591-4ab6-8414-819cfcea5029.png'), home_team=Team(id=5, abbreviation='PIT', city='Pittsburgh', name='Penguins', logo_url='https://lemmy.ca/pictrs/image/3b955364-fc3a-4a6e-b2b1-2b3cd062b4c0.png'), start_time=datetime.datetime(2024, 1, 3, 0, 30, tzinfo=tzutc()), end_time=None, game_info=GameInfo(current_period='', game_clock='--'), away_team_stats=TeamStats(goals=0, shots=0, blocked=0, hits=0, fo_wins=0.0, giveaways=0, takeaways=0, pp_fraction='0/0', periods=[], shootout=Shootout(scores=0, attempts=0, has_been_played=False)), home_team_stats=TeamStats(goals=0, shots=0, blocked=0, hits=0, fo_wins=0.0, giveaways=0, takeaways=0, pp_fraction='0/0', periods=[], shootout=Shootout(scores=0, attempts=0, has_been_played=False)), goals=[], penalties=[])
        game = nhl_api_client.parse_game(self.scheduled_landing)
        print(game)
        self.assertEqual(game, expected)

    def test_bad_goalie_name_split(self):
        expected = ""
        name = "".split(" ")[-1]
        self.assertEqual(expected, name)

    def test_requests_get_stats_url(self):
        # Just test that this URL either works or this exception catches it without crashing the whole program
        try:
            requests.get("https://statsapi.web.nhl.com/api/v1/schedule?startDate=2023-09-20&endDate=2023-09-22&expand=schedule.broadcasts")
        except requests.exceptions.ConnectionError:
            print("connection error")

    def test_get_schedule(self):
        date = "2022-10-31"
        expected = [Game(id=2022020144, away_team=Team(id=17, abbreviation='DET', city='Detroit', name='Red Wings', logo_url='https://lemmy.ca/pictrs/image/7c482335-5915-4e46-86fe-64f0839e7367.png'), home_team=Team(id=7, abbreviation='BUF', city='Buffalo', name='Sabres', logo_url='https://lemmy.ca/pictrs/image/7c7d2a09-9283-4b2c-b66a-902ce43e4c6f.png'), start_time=datetime.datetime(2022, 10, 31, 23, 0, tzinfo=tzutc()), end_time=None, game_info=GameInfo(current_period='0', game_clock='--'), away_team_stats=None, home_team_stats=None, goals=None, penalties=None), Game(id=2022020145, away_team=Team(id=15, abbreviation='WSH', city='Washington', name='Capitals', logo_url='https://lemmy.ca/pictrs/image/045d8587-6591-4ab6-8414-819cfcea5029.png'), home_team=Team(id=12, abbreviation='CAR', city='Carolina', name='Hurricanes', logo_url='https://lemmy.ca/pictrs/image/b37d627b-c321-42dd-bc1e-c760efee3400.png'), start_time=datetime.datetime(2022, 10, 31, 23, 0, tzinfo=tzutc()), end_time=None, game_info=GameInfo(current_period='0', game_clock='--'), away_team_stats=None, home_team_stats=None, goals=None, penalties=None), Game(id=2022020146, away_team=Team(id=26, abbreviation='LAK', city='Los Angeles', name='Kings', logo_url='https://lemmy.ca/pictrs/image/ffa7e866-dd9a-430b-a3a1-61ef62dff3d9.png'), home_team=Team(id=19, abbreviation='STL', city='St. Louis', name='Blues', logo_url='https://lemmy.ca/pictrs/image/d287c13b-d74e-4050-bbab-c7061b62bf4c.png'), start_time=datetime.datetime(2022, 11, 1, 0, 0, tzinfo=tzutc()), end_time=None, game_info=GameInfo(current_period='0', game_clock='--'), away_team_stats=None, home_team_stats=None, goals=None, penalties=None)]
        schedule = nhl_api_client.get_schedule(date)
        print(schedule)
        self.assertEqual(expected, schedule)

    def test_get_games(self):
        date = "2022-10-31"
        schedule = nhl_api_client.get_schedule(date)
        expected = [Game(id=2022020144, away_team=Team(id=17, abbreviation='DET', city='Detroit', name='Red Wings', logo_url='https://lemmy.ca/pictrs/image/7c482335-5915-4e46-86fe-64f0839e7367.png'), home_team=Team(id=7, abbreviation='BUF', city='Buffalo', name='Sabres', logo_url='https://lemmy.ca/pictrs/image/7c7d2a09-9283-4b2c-b66a-902ce43e4c6f.png'), start_time=datetime.datetime(2022, 10, 31, 23, 0, tzinfo=tzutc()), end_time=None, game_info=GameInfo(current_period='3rd', game_clock='FINAL'), away_team_stats=TeamStats(goals=3, shots=18, blocked=12, hits=20, fo_wins=0.507692, giveaways=3, takeaways=9, pp_fraction='0/1', periods=[Period(goals=0, shots=6, period_number=1, ordinal_number='1st'), Period(goals=2, shots=9, period_number=2, ordinal_number='2nd'), Period(goals=1, shots=3, period_number=3, ordinal_number='3rd')], shootout=Shootout(scores=0, attempts=0, has_been_played=False)), home_team_stats=TeamStats(goals=8, shots=46, blocked=5, hits=11, fo_wins=0.492308, giveaways=2, takeaways=8, pp_fraction='2/5', periods=[Period(goals=1, shots=14, period_number=1, ordinal_number='1st'), Period(goals=3, shots=15, period_number=2, ordinal_number='2nd'), Period(goals=4, shots=17, period_number=3, ordinal_number='3rd')], shootout=Shootout(scores=0, attempts=0, has_been_played=False)), goals=[Goal(period='1st', time='16:52', team=Team(id=7, abbreviation='BUF', city='Buffalo', name='Sabres', logo_url='https://lemmy.ca/pictrs/image/7c7d2a09-9283-4b2c-b66a-902ce43e4c6f.png'), strength='Even Strength', description='Tage Thompson (4) slap shot, assists: Jeff Skinner (5), Casey Fitzgerald (1)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335811922112'), Goal(period='2nd', time='01:26', team=Team(id=17, abbreviation='DET', city='Detroit', name='Red Wings', logo_url='https://lemmy.ca/pictrs/image/7c482335-5915-4e46-86fe-64f0839e7367.png'), strength='Even Strength', description='Olli Maatta (2) slap shot, assists: Andrew Copp (3), Filip Hronek (6)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335809781112'), Goal(period='2nd', time='05:22', team=Team(id=7, abbreviation='BUF', city='Buffalo', name='Sabres', logo_url='https://lemmy.ca/pictrs/image/7c7d2a09-9283-4b2c-b66a-902ce43e4c6f.png'), strength='Even Strength', description='Jack Quinn (1) snap shot, assists: Tage Thompson (4), Kyle Okposo (5)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335809385112'), Goal(period='2nd', time='14:26', team=Team(id=7, abbreviation='BUF', city='Buffalo', name='Sabres', logo_url='https://lemmy.ca/pictrs/image/7c7d2a09-9283-4b2c-b66a-902ce43e4c6f.png'), strength='Even Strength', description='Jeff Skinner (2) wrist shot, assists: Tage Thompson (5)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335812022112'), Goal(period='2nd', time='18:30', team=Team(id=7, abbreviation='BUF', city='Buffalo', name='Sabres', logo_url='https://lemmy.ca/pictrs/image/7c7d2a09-9283-4b2c-b66a-902ce43e4c6f.png'), strength='Power Play', description='Tage Thompson (5) wrist shot, assists: Alex Tuch (3), Kyle Okposo (6)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810850112'), Goal(period='2nd', time='19:03', team=Team(id=17, abbreviation='DET', city='Detroit', name='Red Wings', logo_url='https://lemmy.ca/pictrs/image/7c482335-5915-4e46-86fe-64f0839e7367.png'), strength='Even Strength', description='David Perron (5) wrist shot, assists: Joe Veleno (1), Moritz Seider (2)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810731112'), Goal(period='3rd', time='04:19', team=Team(id=17, abbreviation='DET', city='Detroit', name='Red Wings', logo_url='https://lemmy.ca/pictrs/image/7c482335-5915-4e46-86fe-64f0839e7367.png'), strength='Short Handed', description='Dylan Larkin (5) wrist shot, assists: None', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335811232112'), Goal(period='3rd', time='12:53', team=Team(id=7, abbreviation='BUF', city='Buffalo', name='Sabres', logo_url='https://lemmy.ca/pictrs/image/7c7d2a09-9283-4b2c-b66a-902ce43e4c6f.png'), strength='Power Play', description='Rasmus Dahlin (6) wrist shot, assists: Casey Mittelstadt (6), Tage Thompson (6)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335811149112'), Goal(period='3rd', time='14:47', team=Team(id=7, abbreviation='BUF', city='Buffalo', name='Sabres', logo_url='https://lemmy.ca/pictrs/image/7c7d2a09-9283-4b2c-b66a-902ce43e4c6f.png'), strength='Even Strength', description='Dylan Cozens (4) wrist shot, assists: Owen Power (3), JJ Peterka (3)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810848112'), Goal(period='3rd', time='15:58', team=Team(id=7, abbreviation='BUF', city='Buffalo', name='Sabres', logo_url='https://lemmy.ca/pictrs/image/7c7d2a09-9283-4b2c-b66a-902ce43e4c6f.png'), strength='Even Strength', description='Tage Thompson (6) wrist shot, assists: Jeff Skinner (6), Rasmus Dahlin (6)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810078112'), Goal(period='3rd', time='19:21', team=Team(id=7, abbreviation='BUF', city='Buffalo', name='Sabres', logo_url='https://lemmy.ca/pictrs/image/7c7d2a09-9283-4b2c-b66a-902ce43e4c6f.png'), strength='Even Strength', description='Rasmus Asplund (1) wrist shot, assists: Peyton Krebs (2), Zemgus Girgensons (1)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335809975112')], penalties=[Penalty(period='1st', time='17:09', team=Team(id=17, abbreviation='DET', city='Detroit', name='Red Wings', logo_url='https://lemmy.ca/pictrs/image/7c482335-5915-4e46-86fe-64f0839e7367.png'), type='Minor', min=2, description='David Perron hooking against Tage Thompson'), Penalty(period='1st', time='17:55', team=Team(id=7, abbreviation='BUF', city='Buffalo', name='Sabres', logo_url='https://lemmy.ca/pictrs/image/7c7d2a09-9283-4b2c-b66a-902ce43e4c6f.png'), type='Minor', min=2, description='Rasmus Dahlin interference against Moritz Seider'), Penalty(period='2nd', time='16:01', team=Team(id=17, abbreviation='DET', city='Detroit', name='Red Wings', logo_url='https://lemmy.ca/pictrs/image/7c482335-5915-4e46-86fe-64f0839e7367.png'), type='Minor', min=2, description='Gustav Lindstrom holding-the-stick against Zemgus Girgensons'), Penalty(period='2nd', time='17:00', team=Team(id=17, abbreviation='DET', city='Detroit', name='Red Wings', logo_url='https://lemmy.ca/pictrs/image/7c482335-5915-4e46-86fe-64f0839e7367.png'), type='Minor', min=2, description='Ben Chiarot delaying-game-puck-over-glass'), Penalty(period='3rd', time='02:38', team=Team(id=17, abbreviation='DET', city='Detroit', name='Red Wings', logo_url='https://lemmy.ca/pictrs/image/7c482335-5915-4e46-86fe-64f0839e7367.png'), type='Minor', min=2, description='Alex Nedeljkovic interference against Dylan Cozens'), Penalty(period='3rd', time='09:51', team=Team(id=7, abbreviation='BUF', city='Buffalo', name='Sabres', logo_url='https://lemmy.ca/pictrs/image/7c7d2a09-9283-4b2c-b66a-902ce43e4c6f.png'), type='Minor', min=2, description='Casey Fitzgerald cross-checking against Dylan Larkin'), Penalty(period='3rd', time='09:51', team=Team(id=17, abbreviation='DET', city='Detroit', name='Red Wings', logo_url='https://lemmy.ca/pictrs/image/7c482335-5915-4e46-86fe-64f0839e7367.png'), type='Minor', min=2, description='Dylan Larkin unsportsmanlike-conduct against Casey Fitzgerald'), Penalty(period='3rd', time='11:06', team=Team(id=17, abbreviation='DET', city='Detroit', name='Red Wings', logo_url='https://lemmy.ca/pictrs/image/7c482335-5915-4e46-86fe-64f0839e7367.png'), type='Minor', min=2, description='Joe Veleno holding against Lawrence Pilut')]), Game(id=2022020145, away_team=Team(id=15, abbreviation='WSH', city='Washington', name='Capitals', logo_url='https://lemmy.ca/pictrs/image/045d8587-6591-4ab6-8414-819cfcea5029.png'), home_team=Team(id=12, abbreviation='CAR', city='Carolina', name='Hurricanes', logo_url='https://lemmy.ca/pictrs/image/b37d627b-c321-42dd-bc1e-c760efee3400.png'), start_time=datetime.datetime(2022, 10, 31, 23, 0, tzinfo=tzutc()), end_time=None, game_info=GameInfo(current_period='SO', game_clock='FINAL'), away_team_stats=TeamStats(goals=2, shots=20, blocked=20, hits=32, fo_wins=0.45, giveaways=6, takeaways=4, pp_fraction='1/4', periods=[Period(goals=0, shots=5, period_number=1, ordinal_number='1st'), Period(goals=2, shots=7, period_number=2, ordinal_number='2nd'), Period(goals=0, shots=7, period_number=3, ordinal_number='3rd'), Period(goals=0, shots=1, period_number=4, ordinal_number='OT')], shootout=Shootout(scores=1, attempts=3, has_been_played=True)), home_team_stats=TeamStats(goals=3, shots=35, blocked=7, hits=21, fo_wins=0.55, giveaways=9, takeaways=8, pp_fraction='1/6', periods=[Period(goals=1, shots=11, period_number=1, ordinal_number='1st'), Period(goals=1, shots=6, period_number=2, ordinal_number='2nd'), Period(goals=0, shots=15, period_number=3, ordinal_number='3rd'), Period(goals=0, shots=3, period_number=4, ordinal_number='OT')], shootout=Shootout(scores=2, attempts=3, has_been_played=True)), goals=[Goal(period='1st', time='04:27', team=Team(id=12, abbreviation='CAR', city='Carolina', name='Hurricanes', logo_url='https://lemmy.ca/pictrs/image/b37d627b-c321-42dd-bc1e-c760efee3400.png'), strength='Power Play', description='Stefan Noesen (1) tip-in shot, assists: Brent Burns (5), Martin Necas (7)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335811539112'), Goal(period='2nd', time='01:23', team=Team(id=15, abbreviation='WSH', city='Washington', name='Capitals', logo_url='https://lemmy.ca/pictrs/image/045d8587-6591-4ab6-8414-819cfcea5029.png'), strength='Even Strength', description='Dylan Strome (2) wrist shot, assists: Nick Jensen (6), Conor Sheary (3)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335809861112'), Goal(period='2nd', time='08:57', team=Team(id=15, abbreviation='WSH', city='Washington', name='Capitals', logo_url='https://lemmy.ca/pictrs/image/045d8587-6591-4ab6-8414-819cfcea5029.png'), strength='Power Play', description='Alex Ovechkin (5) slap shot, assists: Erik Gustafsson (3), Evgeny Kuznetsov (6)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335809384112'), Goal(period='2nd', time='15:42', team=Team(id=12, abbreviation='CAR', city='Carolina', name='Hurricanes', logo_url='https://lemmy.ca/pictrs/image/b37d627b-c321-42dd-bc1e-c760efee3400.png'), strength='Even Strength', description='Andrei Svechnikov (8) wrist shot, assists: Paul Stastny (3), Martin Necas (8)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335809685112'), Goal(period='SO', time='00:00', team=Team(id=12, abbreviation='CAR', city='Carolina', name='Hurricanes', logo_url='https://lemmy.ca/pictrs/image/b37d627b-c321-42dd-bc1e-c760efee3400.png'), strength='Even Strength', description='Andrei Svechnikov (8) wrist shot, assists: None', video_url='')], penalties=[Penalty(period='1st', time='03:15', team=Team(id=15, abbreviation='WSH', city='Washington', name='Capitals', logo_url='https://lemmy.ca/pictrs/image/045d8587-6591-4ab6-8414-819cfcea5029.png'), type='Minor', min=2, description='Aliaksei Protas tripping against Jordan Martinook'), Penalty(period='1st', time='13:10', team=Team(id=12, abbreviation='CAR', city='Carolina', name='Hurricanes', logo_url='https://lemmy.ca/pictrs/image/b37d627b-c321-42dd-bc1e-c760efee3400.png'), type='Minor', min=2, description='Brett Pesce delaying-game-puck-over-glass'), Penalty(period='1st', time='16:02', team=Team(id=12, abbreviation='CAR', city='Carolina', name='Hurricanes', logo_url='https://lemmy.ca/pictrs/image/b37d627b-c321-42dd-bc1e-c760efee3400.png'), type='Minor', min=2, description='Stefan Noesen illegal-check-to-head against Martin Fehervary'), Penalty(period='2nd', time='04:01', team=Team(id=15, abbreviation='WSH', city='Washington', name='Capitals', logo_url='https://lemmy.ca/pictrs/image/045d8587-6591-4ab6-8414-819cfcea5029.png'), type='Minor', min=2, description='Nic Dowd interference against Derek Stepan'), Penalty(period='2nd', time='07:39', team=Team(id=12, abbreviation='CAR', city='Carolina', name='Hurricanes', logo_url='https://lemmy.ca/pictrs/image/b37d627b-c321-42dd-bc1e-c760efee3400.png'), type='Minor', min=2, description='Brett Pesce interference against Conor Sheary'), Penalty(period='2nd', time='10:50', team=Team(id=15, abbreviation='WSH', city='Washington', name='Capitals', logo_url='https://lemmy.ca/pictrs/image/045d8587-6591-4ab6-8414-819cfcea5029.png'), type='Minor', min=2, description='Marcus Johansson clipping against Brett Pesce'), Penalty(period='2nd', time='18:23', team=Team(id=15, abbreviation='WSH', city='Washington', name='Capitals', logo_url='https://lemmy.ca/pictrs/image/045d8587-6591-4ab6-8414-819cfcea5029.png'), type='Minor', min=2, description='Alex Ovechkin slashing against Brett Pesce'), Penalty(period='3rd', time='02:09', team=Team(id=12, abbreviation='CAR', city='Carolina', name='Hurricanes', logo_url='https://lemmy.ca/pictrs/image/b37d627b-c321-42dd-bc1e-c760efee3400.png'), type='Minor', min=2, description='Sebastian Aho tripping against Dylan Strome'), Penalty(period='3rd', time='08:11', team=Team(id=15, abbreviation='WSH', city='Washington', name='Capitals', logo_url='https://lemmy.ca/pictrs/image/045d8587-6591-4ab6-8414-819cfcea5029.png'), type='Minor', min=2, description='Darcy Kuemper interference against Martin Necas'), Penalty(period='3rd', time='08:11', team=Team(id=12, abbreviation='CAR', city='Carolina', name='Hurricanes', logo_url='https://lemmy.ca/pictrs/image/b37d627b-c321-42dd-bc1e-c760efee3400.png'), type='Minor', min=2, description='Martin Necas embellishment against Darcy Kuemper'), Penalty(period='3rd', time='13:50', team=Team(id=12, abbreviation='CAR', city='Carolina', name='Hurricanes', logo_url='https://lemmy.ca/pictrs/image/b37d627b-c321-42dd-bc1e-c760efee3400.png'), type='Minor', min=2, description='Paul Stastny interference against Nic Dowd'), Penalty(period='3rd', time='13:50', team=Team(id=15, abbreviation='WSH', city='Washington', name='Capitals', logo_url='https://lemmy.ca/pictrs/image/045d8587-6591-4ab6-8414-819cfcea5029.png'), type='Minor', min=2, description='Nic Dowd embellishment against Paul Stastny'), Penalty(period='3rd', time='18:05', team=Team(id=15, abbreviation='WSH', city='Washington', name='Capitals', logo_url='https://lemmy.ca/pictrs/image/045d8587-6591-4ab6-8414-819cfcea5029.png'), type='Minor', min=2, description='Marcus Johansson tripping against Andrei Svechnikov'), Penalty(period='OT', time='02:09', team=Team(id=15, abbreviation='WSH', city='Washington', name='Capitals', logo_url='https://lemmy.ca/pictrs/image/045d8587-6591-4ab6-8414-819cfcea5029.png'), type='Minor', min=2, description='Lars Eller tripping against Sebastian Aho')]), Game(id=2022020146, away_team=Team(id=26, abbreviation='LAK', city='Los Angeles', name='Kings', logo_url='https://lemmy.ca/pictrs/image/ffa7e866-dd9a-430b-a3a1-61ef62dff3d9.png'), home_team=Team(id=19, abbreviation='STL', city='St. Louis', name='Blues', logo_url='https://lemmy.ca/pictrs/image/d287c13b-d74e-4050-bbab-c7061b62bf4c.png'), start_time=datetime.datetime(2022, 11, 1, 0, 0, tzinfo=tzutc()), end_time=None, game_info=GameInfo(current_period='3rd', game_clock='FINAL'), away_team_stats=TeamStats(goals=5, shots=30, blocked=12, hits=17, fo_wins=0.490566, giveaways=4, takeaways=15, pp_fraction='1/3', periods=[Period(goals=1, shots=7, period_number=1, ordinal_number='1st'), Period(goals=4, shots=16, period_number=2, ordinal_number='2nd'), Period(goals=0, shots=7, period_number=3, ordinal_number='3rd')], shootout=Shootout(scores=0, attempts=0, has_been_played=False)), home_team_stats=TeamStats(goals=1, shots=28, blocked=9, hits=33, fo_wins=0.509434, giveaways=11, takeaways=5, pp_fraction='0/4', periods=[Period(goals=0, shots=8, period_number=1, ordinal_number='1st'), Period(goals=1, shots=8, period_number=2, ordinal_number='2nd'), Period(goals=0, shots=12, period_number=3, ordinal_number='3rd')], shootout=Shootout(scores=0, attempts=0, has_been_played=False)), goals=[Goal(period='1st', time='13:12', team=Team(id=26, abbreviation='LAK', city='Los Angeles', name='Kings', logo_url='https://lemmy.ca/pictrs/image/ffa7e866-dd9a-430b-a3a1-61ef62dff3d9.png'), strength='Even Strength', description='Gabriel Vilardi (8) tip-in shot, assists: Kevin Fiala (8), Adrian Kempe (3)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335809383112'), Goal(period='2nd', time='03:44', team=Team(id=26, abbreviation='LAK', city='Los Angeles', name='Kings', logo_url='https://lemmy.ca/pictrs/image/ffa7e866-dd9a-430b-a3a1-61ef62dff3d9.png'), strength='Even Strength', description='Carl Grundstrom (2) tip-in shot, assists: Rasmus Kupari (1), Kevin Fiala (9)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810083112'), Goal(period='2nd', time='05:06', team=Team(id=26, abbreviation='LAK', city='Los Angeles', name='Kings', logo_url='https://lemmy.ca/pictrs/image/ffa7e866-dd9a-430b-a3a1-61ef62dff3d9.png'), strength='Even Strength', description='Anze Kopitar (2) tip-in shot, assists: Gabriel Vilardi (5), Drew Doughty (4)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335811434112'), Goal(period='2nd', time='07:39', team=Team(id=26, abbreviation='LAK', city='Los Angeles', name='Kings', logo_url='https://lemmy.ca/pictrs/image/ffa7e866-dd9a-430b-a3a1-61ef62dff3d9.png'), strength='Power Play', description='Arthur Kaliyev (3) wrist shot, assists: Trevor Moore (7), Viktor Arvidsson (3)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335810082112'), Goal(period='2nd', time='09:59', team=Team(id=26, abbreviation='LAK', city='Los Angeles', name='Kings', logo_url='https://lemmy.ca/pictrs/image/ffa7e866-dd9a-430b-a3a1-61ef62dff3d9.png'), strength='Even Strength', description='Carl Grundstrom (3) snap shot, assists: Kevin Fiala (10), Matt Roy (2)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335809859112'), Goal(period='2nd', time='10:42', team=Team(id=19, abbreviation='STL', city='St. Louis', name='Blues', logo_url='https://lemmy.ca/pictrs/image/d287c13b-d74e-4050-bbab-c7061b62bf4c.png'), strength='Even Strength', description='Alexey Toropchenko (1) poke shot, assists: Ivan Barbashev (1), Noel Acciari (1)', video_url='https://players.brightcove.net/6415718365001/EXtG1xJ7H_default/index.html?videoId=6335811231112')], penalties=[Penalty(period='1st', time='04:20', team=Team(id=26, abbreviation='LAK', city='Los Angeles', name='Kings', logo_url='https://lemmy.ca/pictrs/image/ffa7e866-dd9a-430b-a3a1-61ef62dff3d9.png'), type='Minor', min=2, description='Adrian Kempe hooking against Colton Parayko'), Penalty(period='2nd', time='05:39', team=Team(id=19, abbreviation='STL', city='St. Louis', name='Blues', logo_url='https://lemmy.ca/pictrs/image/d287c13b-d74e-4050-bbab-c7061b62bf4c.png'), type='Minor', min=2, description='Justin Faulk high-sticking against Blake Lizotte'), Penalty(period='2nd', time='16:19', team=Team(id=19, abbreviation='STL', city='St. Louis', name='Blues', logo_url='https://lemmy.ca/pictrs/image/d287c13b-d74e-4050-bbab-c7061b62bf4c.png'), type='Minor', min=2, description='Brayden Schenn holding against Kevin Fiala'), Penalty(period='2nd', time='19:21', team=Team(id=26, abbreviation='LAK', city='Los Angeles', name='Kings', logo_url='https://lemmy.ca/pictrs/image/ffa7e866-dd9a-430b-a3a1-61ef62dff3d9.png'), type='Minor', min=2, description='Arthur Kaliyev delaying-game-puck-over-glass'), Penalty(period='3rd', time='01:51', team=Team(id=26, abbreviation='LAK', city='Los Angeles', name='Kings', logo_url='https://lemmy.ca/pictrs/image/ffa7e866-dd9a-430b-a3a1-61ef62dff3d9.png'), type='Minor', min=2, description='Carl Grundstrom boarding against Torey Krug'), Penalty(period='3rd', time='06:54', team=Team(id=19, abbreviation='STL', city='St. Louis', name='Blues', logo_url='https://lemmy.ca/pictrs/image/d287c13b-d74e-4050-bbab-c7061b62bf4c.png'), type='Minor', min=2, description='Robert Bortuzzo slashing against Carl Grundstrom'), Penalty(period='3rd', time='18:09', team=Team(id=26, abbreviation='LAK', city='Los Angeles', name='Kings', logo_url='https://lemmy.ca/pictrs/image/ffa7e866-dd9a-430b-a3a1-61ef62dff3d9.png'), type='Minor', min=2, description='Sean Durzi tripping against Tyler Pitlick')])]
        games = nhl_api_client.get_games(schedule)
        print(games)
        self.assertEqual(expected, games)

    def test_get_penalty_types(self):
        # This is a really dumb test, but I wasn't sure how map.get with default values works in python, so I wanted to write a scratch for it just to be sure I understood it.
        # But I figured if I am writing a scratch, I might as well keep it as a test case to reference later in case I forget. :)
        bad_key = "BAD_KEY"
        not_found = "NOT_FOUND"
        for i in range(len(nhl_api_client.penalty_type_map)):
            self.assertEqual(nhl_api_client.penalty_type_map.get(list(nhl_api_client.penalty_type_map.keys())[i], not_found), list(nhl_api_client.penalty_type_map.values())[i], "Key/value mismatch: key: " + list(nhl_api_client.penalty_type_map.keys())[i] + " value: " + list(nhl_api_client.penalty_type_map.values())[i])
        self.assertEqual(nhl_api_client.penalty_type_map.get(bad_key, not_found), not_found, "Bad key test failed: key: " + bad_key + " value: " + not_found)


if __name__ == '__main__':
    unittest.main()
